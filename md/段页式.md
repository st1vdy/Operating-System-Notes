# 段页式内存管理

## 分段和分页的对比

- 分页对用户不可见，分段对用户可见。

- 分页管理对内存的空间利用率更高，不会产生外部碎片，只会有少量的页内碎片。分段管理可能产生较长的段，并且会产生外部碎片。

- 分段更容易实现信息的共享和保护。

  这是因为分段是按照进程内的各个模块划分进程为片段，但是分页的大小是固定的，会导致同一模块的信息分散到不同页面，也可能导致一个页面中有不同模块。

## 段页式管理

段页式管理实际上就是：先分段，再分页；即先对进程分段管理，然后各个片段的内部再分页管理。

如下图，这是一个段页式管理的逻辑地址含义。

<img src="pics/seg-page1.png" alt="seg-page1" style="zoom:50%;" />

其中**段号**占16位，因此最多分 $2^{16}$ 段；**页号**占 $4$ 位，每段最多分 $2^{4}$ 页；**页偏移**占 $12$ 位，每个页面最大容量为 $2^{12}B$。

段页式管理显然既需要**段表**，也需要**页表**，其中段表维护段号到对应的页表地址的映射，页表就是常规的页面到页帧的映射。因此总共需要3次访存（段表，页表，物理地址）。